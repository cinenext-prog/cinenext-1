<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CineNext Livepeer 管理后台</title>
    <link rel="stylesheet" href="/admin.css" />
  </head>
  <body>
    <main class="page">
      <header class="header">
        <h1>Livepeer 资产管理</h1>
        <p>按剧统一管理 Livepeer 资产：显示总集数，按集数顺序排列，并支持编辑与删除。</p>
      </header>

      <section class="panel">
        <h2>API 连接</h2>
        <div class="inline-row">
          <label class="inline-input">
            Livepeer API Key
            <input id="api-key" type="password" placeholder="请输入 Livepeer API Key" autocomplete="off" />
          </label>
          <div class="actions-row">
            <button type="button" id="save-key" class="secondary">保存到本地</button>
            <button type="button" id="connect-api">连接并拉取</button>
            <button type="button" id="clear-key" class="danger">清除 Key</button>
          </div>
        </div>
        <p id="api-status" class="tip">尚未连接。</p>
      </section>

      <section class="panel">
        <div class="list-head">
          <h2>剧集列表</h2>
          <div class="actions-row">
            <input id="search-input" placeholder="按名称/Playback ID 搜索" />
            <button id="refresh-list" class="secondary">刷新列表</button>
            <button id="go-upload">上传视频</button>
          </div>
        </div>

        <div id="empty-state" class="empty">当前没有资产，请先连接后点击“上传视频”。</div>
        <div id="series-list" class="series-list"></div>
      </section>

      <section id="edit-panel" class="panel" hidden>
        <h2>编辑资产元数据</h2>
        <form id="edit-form" class="form-grid">
          <label>
            Asset ID
            <input id="edit-id" readonly />
          </label>

          <label>
            资源名称
            <input id="edit-name" required />
          </label>

          <label>
            剧名（seriesName）
            <input id="edit-series-name" required placeholder="例如：总裁的替身新娘" />
          </label>

          <label>
            集数（episodeNumber）
            <input id="edit-episode-number" type="number" min="1" step="1" required />
          </label>

          <label class="full-width">
            metadata（JSON）
            <textarea id="edit-metadata-json" rows="6"></textarea>
          </label>

          <div class="actions">
            <button type="submit" id="edit-submit">保存修改</button>
            <button type="button" id="edit-cancel" class="secondary">取消编辑</button>
          </div>
        </form>
      </section>

      <section id="series-edit-panel" class="panel" hidden>
        <h2>编辑本剧信息</h2>
        <form id="series-edit-form" class="form-grid">
          <label>
            原剧名
            <input id="series-edit-original-name" readonly />
          </label>

          <label>
            新剧名
            <input id="series-edit-name" required />
          </label>

          <label>
            总集数
            <input id="series-edit-total-episodes" type="number" min="1" step="1" required />
          </label>

          <label>
            前 X 集免费
            <input id="series-edit-free-episodes" type="number" min="0" step="1" required />
          </label>

          <label>
            每集价格 TON
            <input id="series-edit-price" type="number" min="0" step="0.1" required />
          </label>

          <label>
            演员（逗号分隔）
            <input id="series-edit-actors" placeholder="演员A,演员B" />
          </label>

          <label class="full-width">
            简介
            <textarea id="series-edit-description" rows="4"></textarea>
          </label>

          <div class="actions">
            <button type="submit" id="series-edit-submit">保存本剧信息</button>
            <button type="button" id="series-edit-cancel" class="secondary">取消</button>
          </div>
        </form>
      </section>

      <section class="panel">
        <h2>说明</h2>
        <p class="tip">1）首页只负责“按剧管理列表”，上传请点“上传视频”进入独立页面。</p>
        <p class="tip">2）每条视频建议都写入 metadata：seriesName + episodeNumber。</p>
        <p class="tip">3）列表会按剧名分组，并按集数从小到大排序。</p>
      </section>

      <p id="toast" class="toast" aria-live="polite"></p>
    </main>

    <script type="module" src="/admin.js"></script>
  </body>
</html>
