<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Telegram WebApp Test</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      padding: 20px;
      max-width: 600px;
      margin: 0 auto;
      background: var(--tg-theme-bg-color, #fff);
      color: var(--tg-theme-text-color, #000);
    }
    .info-box {
      background: var(--tg-theme-secondary-bg-color, #f5f5f5);
      padding: 15px;
      border-radius: 8px;
      margin: 10px 0;
    }
    .info-box h3 {
      margin: 0 0 10px 0;
      color: var(--tg-theme-button-color, #3390ec);
    }
    pre {
      background: #000;
      color: #0f0;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 12px;
    }
    button {
      background: var(--tg-theme-button-color, #3390ec);
      color: var(--tg-theme-button-text-color, #fff);
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover {
      opacity: 0.8;
    }
  </style>
</head>
<body>
  <h1>ğŸ”§ Telegram WebApp æµ‹è¯•</h1>
  
  <div class="info-box">
    <h3>ç”¨æˆ·ä¿¡æ¯</h3>
    <div id="userInfo">åŠ è½½ä¸­...</div>
  </div>
  
  <div class="info-box">
    <h3>ç¯å¢ƒä¿¡æ¯</h3>
    <div id="envInfo">åŠ è½½ä¸­...</div>
  </div>
  
  <div class="info-box">
    <h3>ä¸»é¢˜é¢œè‰²</h3>
    <div id="themeInfo">åŠ è½½ä¸­...</div>
  </div>
  
  <div class="info-box">
    <h3>æµ‹è¯•åŠŸèƒ½</h3>
    <button onclick="testShowAlert()">æ˜¾ç¤ºè­¦å‘Š</button>
    <button onclick="testShowConfirm()">æ˜¾ç¤ºç¡®è®¤</button>
    <button onclick="testHaptic()">è§¦è§‰åé¦ˆ</button>
    <button onclick="testMainButton()">åˆ‡æ¢ä¸»æŒ‰é’®</button>
  </div>
  
  <div class="info-box">
    <h3>å®Œæ•´æ•°æ®</h3>
    <pre id="fullData">åŠ è½½ä¸­...</pre>
  </div>

  <script>
    const tg = window.Telegram.WebApp;
    
    // åˆå§‹åŒ–
    tg.ready();
    tg.expand();
    
    // æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
    function displayUserInfo() {
      const user = tg.initDataUnsafe?.user;
      const userDiv = document.getElementById('userInfo');
      
      if (user) {
        userDiv.innerHTML = `
          <p><strong>ID:</strong> ${user.id}</p>
          <p><strong>åç§°:</strong> ${user.first_name} ${user.last_name || ''}</p>
          <p><strong>ç”¨æˆ·å:</strong> @${user.username || 'æ— '}</p>
          <p><strong>è¯­è¨€:</strong> ${user.language_code || 'æœªçŸ¥'}</p>
        `;
      } else {
        userDiv.innerHTML = '<p>âš ï¸ æœªåœ¨ Telegram ä¸­æ‰“å¼€</p>';
      }
    }
    
    // æ˜¾ç¤ºç¯å¢ƒä¿¡æ¯
    function displayEnvInfo() {
      const envDiv = document.getElementById('envInfo');
      envDiv.innerHTML = `
        <p><strong>å¹³å°:</strong> ${tg.platform}</p>
        <p><strong>ç‰ˆæœ¬:</strong> ${tg.version}</p>
        <p><strong>è§†å£é«˜åº¦:</strong> ${tg.viewportHeight}px</p>
        <p><strong>æ˜¯å¦å±•å¼€:</strong> ${tg.isExpanded ? 'æ˜¯' : 'å¦'}</p>
      `;
    }
    
    // æ˜¾ç¤ºä¸»é¢˜ä¿¡æ¯
    function displayThemeInfo() {
      const themeDiv = document.getElementById('themeInfo');
      themeDiv.innerHTML = `
        <p><strong>èƒŒæ™¯è‰²:</strong> ${tg.themeParams.bg_color || 'é»˜è®¤'}</p>
        <p><strong>æ–‡å­—è‰²:</strong> ${tg.themeParams.text_color || 'é»˜è®¤'}</p>
        <p><strong>æç¤ºè‰²:</strong> ${tg.themeParams.hint_color || 'é»˜è®¤'}</p>
        <p><strong>æŒ‰é’®è‰²:</strong> ${tg.themeParams.button_color || 'é»˜è®¤'}</p>
      `;
    }
    
    // æ˜¾ç¤ºå®Œæ•´æ•°æ®
    function displayFullData() {
      const fullDiv = document.getElementById('fullData');
      const data = {
        initData: tg.initData,
        initDataUnsafe: tg.initDataUnsafe,
        platform: tg.platform,
        version: tg.version,
        colorScheme: tg.colorScheme,
        themeParams: tg.themeParams,
        isExpanded: tg.isExpanded,
        viewportHeight: tg.viewportHeight,
        viewportStableHeight: tg.viewportStableHeight,
      };
      fullDiv.textContent = JSON.stringify(data, null, 2);
    }
    
    // æµ‹è¯•å‡½æ•°
    function testShowAlert() {
      tg.showAlert('è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•è­¦å‘Šï¼');
    }
    
    function testShowConfirm() {
      tg.showConfirm('ç¡®è®¤è¦ç»§ç»­å—ï¼Ÿ', (confirmed) => {
        tg.showAlert(confirmed ? 'ä½ ç‚¹å‡»äº†ç¡®è®¤' : 'ä½ ç‚¹å‡»äº†å–æ¶ˆ');
      });
    }
    
    function testHaptic() {
      if (tg.HapticFeedback) {
        tg.HapticFeedback.impactOccurred('medium');
        setTimeout(() => tg.HapticFeedback.notificationOccurred('success'), 200);
      } else {
        alert('å½“å‰ç¯å¢ƒä¸æ”¯æŒè§¦è§‰åé¦ˆ');
      }
    }
    
    let mainButtonVisible = false;
    function testMainButton() {
      mainButtonVisible = !mainButtonVisible;
      
      if (mainButtonVisible) {
        tg.MainButton.setText('ä¸»æŒ‰é’®å·²æ¿€æ´»');
        tg.MainButton.show();
        tg.MainButton.onClick(() => {
          tg.showAlert('ä¸»æŒ‰é’®è¢«ç‚¹å‡»äº†ï¼');
        });
      } else {
        tg.MainButton.hide();
      }
    }
    
    // åˆå§‹åŒ–æ˜¾ç¤º
    displayUserInfo();
    displayEnvInfo();
    displayThemeInfo();
    displayFullData();
    
    // ç›‘å¬è§†å£å˜åŒ–
    tg.onEvent('viewportChanged', () => {
      displayEnvInfo();
    });
    
    // ç›‘å¬ä¸»é¢˜å˜åŒ–
    tg.onEvent('themeChanged', () => {
      displayThemeInfo();
    });
  </script>
</body>
</html>
