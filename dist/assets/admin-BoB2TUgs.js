import"./modulepreload-polyfill-B5Qt9EMX.js";const g="cinenext_videos",I="legacyVideos",f=document.querySelector("#video-form"),E=document.querySelector("#title"),A=document.querySelector("#playbackId"),S=document.querySelector("#episode"),k=document.querySelector("#unlockType"),L=document.querySelector("#nftCollectionAddress"),b=document.querySelector("#price"),T=document.querySelector("#actors"),$=document.querySelector("#keywords"),m=document.querySelector("#video-tbody"),v=document.querySelector("#video-table"),h=document.querySelector("#empty-state"),a=document.querySelector("#toast"),x=document.querySelector("#reset-form"),N=document.querySelector("#refresh-list"),O=document.querySelector("#clear-all"),C=document.querySelector("#export-json"),p=document.querySelector("#import-json"),q=(t,e)=>{try{return JSON.parse(t)}catch{return e}},d=()=>{const t=localStorage.getItem(g)||localStorage.getItem(I);if(!t)return[];const e=q(t,[]);return Array.isArray(e)?e:[]},i=t=>{localStorage.setItem(g,JSON.stringify(t)),localStorage.setItem(I,JSON.stringify(t))},c=(t,e=!1)=>{a.textContent=t,a.style.color=e?"#ff9d9d":"#89d6a8",window.setTimeout(()=>{a.textContent===t&&(a.textContent="")},2200)},w=t=>String(t||"").split(",").map(e=>e.trim()).filter(Boolean),l=(t,e)=>Math.floor(t+Math.random()*(e-t)),M=(t,e)=>{const r=document.createElement("tr");return r.innerHTML=`
    <td>${t.title||"-"}</td>
    <td>${t.episode||e+1}</td>
    <td>${t.playbackId||"-"}</td>
    <td>${t.unlockType==="nft"?"NFT":"免费"}</td>
    <td class="actions-cell">
      <button type="button" data-action="delete" data-id="${t.id}">删除</button>
    </td>
  `,r},s=()=>{const t=d();if(m.innerHTML="",t.length===0){v.hidden=!0,h.hidden=!1;return}v.hidden=!1,h.hidden=!0,t.forEach((e,r)=>{m.appendChild(M(e,r))})},R=()=>{const t=E.value.trim(),e=A.value.trim();if(!t)throw new Error("请填写剧名");if(!e)throw new Error("请填写 Playback ID");const r=k.value==="nft"?"nft":"free",o=Math.max(1,Number(S.value||1));return{id:`legacy-${Date.now()}-${Math.random().toString(36).slice(2,7)}`,title:t,playbackId:e,playbackUrl:`https://livepeercdn.com/hls/${e}/index.m3u8`,unlockType:r,nftCollectionAddress:r==="nft"?L.value.trim():"",price:String(b.value||"0.5"),actors:w(T.value),keywords:w($.value),episode:o,likes:l(1e3,6e3),views:l(1e4,3e5)}};f.addEventListener("submit",t=>{t.preventDefault();try{const e=R(),r=d();if(r.some(o=>o.playbackId===e.playbackId)){c("该 Playback ID 已存在",!0);return}r.unshift(e),i(r),f.reset(),S.value="1",b.value="0.5",k.value="free",s(),c("已添加短剧")}catch(e){c(e.message||"添加失败",!0)}});m.addEventListener("click",t=>{const e=t.target;if(!(e instanceof HTMLElement)||e.dataset.action!=="delete")return;const r=e.dataset.id;if(!r)return;const u=d().filter(n=>n.id!==r);i(u),s(),c("已删除")});x.addEventListener("click",()=>{f.reset(),S.value="1",b.value="0.5",k.value="free"});N.addEventListener("click",()=>{s(),c("已刷新")});O.addEventListener("click",()=>{window.confirm("确认清空全部短剧吗？")&&(i([]),s(),c("已清空"))});C.addEventListener("click",()=>{const t=d(),e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),r=URL.createObjectURL(e),o=document.createElement("a");o.href=r,o.download="cinenext_videos.json",o.click(),URL.revokeObjectURL(r),c("已导出 JSON")});p.addEventListener("change",async()=>{var e;const t=(e=p.files)==null?void 0:e[0];if(t)try{const r=await t.text(),o=q(r,null);if(!Array.isArray(o))throw new Error("JSON 格式无效，必须是数组");const u=o.map((n,y)=>({id:String(n.id||`legacy-import-${Date.now()}-${y}`),title:String(n.title||`短剧 ${y+1}`),playbackId:String(n.playbackId||"").trim(),playbackUrl:String(n.playbackUrl||`https://livepeercdn.com/hls/${n.playbackId||""}/index.m3u8`),unlockType:n.unlockType==="nft"?"nft":"free",nftCollectionAddress:String(n.nftCollectionAddress||""),price:String(n.price||"0.5"),actors:Array.isArray(n.actors)?n.actors:[],keywords:Array.isArray(n.keywords)?n.keywords:[],episode:Math.max(1,Number(n.episode||y+1)),likes:Number(n.likes||l(1e3,6e3)),views:Number(n.views||l(1e4,3e5))})).filter(n=>n.playbackId);i(u),s(),c("导入成功")}catch(r){c(r.message||"导入失败",!0)}finally{p.value=""}});s();
//# sourceMappingURL=admin-BoB2TUgs.js.map
