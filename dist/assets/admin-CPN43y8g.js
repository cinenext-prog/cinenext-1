import"./modulepreload-polyfill-B5Qt9EMX.js";const g="cinenext_videos",E="legacyVideos",f=document.querySelector("#video-form"),q=document.querySelector("#title"),A=document.querySelector("#playbackId"),m=document.querySelector("#playbackUrl"),S=document.querySelector("#episode"),b=document.querySelector("#unlockType"),T=document.querySelector("#nftCollectionAddress"),v=document.querySelector("#price"),$=document.querySelector("#actors"),x=document.querySelector("#keywords"),k=document.querySelector("#video-tbody"),h=document.querySelector("#video-table"),w=document.querySelector("#empty-state"),l=document.querySelector("#toast"),N=document.querySelector("#reset-form"),O=document.querySelector("#refresh-list"),U=document.querySelector("#clear-all"),C=document.querySelector("#export-json"),p=document.querySelector("#import-json"),L=(e,t)=>{try{return JSON.parse(e)}catch{return t}},d=()=>{const e=localStorage.getItem(g)||localStorage.getItem(E);if(!e)return[];const t=L(e,[]);return Array.isArray(t)?t:[]},u=e=>{localStorage.setItem(g,JSON.stringify(e)),localStorage.setItem(E,JSON.stringify(e))},c=(e,t=!1)=>{l.textContent=e,l.style.color=t?"#ff9d9d":"#89d6a8",window.setTimeout(()=>{l.textContent===e&&(l.textContent="")},2200)},I=e=>String(e||"").split(",").map(t=>t.trim()).filter(Boolean),i=(e,t)=>Math.floor(e+Math.random()*(t-e)),M=e=>/^[a-zA-Z0-9_-]{8,}$/.test(e),P=e=>/^https:\/\/.+\.(m3u8|mp4)(\?.*)?$/i.test(e),D=(e,t)=>{const r=document.createElement("tr");return r.innerHTML=`
    <td>${e.title||"-"}</td>
    <td>${e.episode||t+1}</td>
    <td>${e.playbackId||"-"}</td>
    <td>${e.unlockType==="nft"?"NFT":"免费"}</td>
    <td class="actions-cell">
      <button type="button" data-action="delete" data-id="${e.id}">删除</button>
    </td>
  `,r},a=()=>{const e=d();if(k.innerHTML="",e.length===0){h.hidden=!0,w.hidden=!1;return}h.hidden=!1,w.hidden=!0,e.forEach((t,r)=>{k.appendChild(D(t,r))})},R=()=>{const e=q.value.trim(),t=A.value.trim(),r=m.value.trim();if(!e)throw new Error("请填写剧名");if(!t)throw new Error("请填写 Playback ID");if(!M(t))throw new Error("Playback ID 格式不正确，请填写 Livepeer 真实 Playback ID（不要填 1/2/3）");if(r&&!P(r))throw new Error("播放地址格式不正确，请填写 https 开头的 m3u8/mp4 链接");const n=b.value==="nft"?"nft":"free",s=Math.max(1,Number(S.value||1));return{id:`legacy-${Date.now()}-${Math.random().toString(36).slice(2,7)}`,title:e,playbackId:t,playbackUrl:r||`https://livepeercdn.com/hls/${t}/index.m3u8`,unlockType:n,nftCollectionAddress:n==="nft"?T.value.trim():"",price:String(v.value||"0.5"),actors:I($.value),keywords:I(x.value),episode:s,likes:i(1e3,6e3),views:i(1e4,3e5)}};f.addEventListener("submit",e=>{e.preventDefault();try{const t=R(),r=d();if(r.some(n=>n.playbackId===t.playbackId)){c("该 Playback ID 已存在",!0);return}r.unshift(t),u(r),f.reset(),S.value="1",v.value="0.5",b.value="free",a(),c("已添加短剧")}catch(t){c(t.message||"添加失败",!0)}});k.addEventListener("click",e=>{const t=e.target;if(!(t instanceof HTMLElement)||t.dataset.action!=="delete")return;const r=t.dataset.id;if(!r)return;const s=d().filter(o=>o.id!==r);u(s),a(),c("已删除")});N.addEventListener("click",()=>{f.reset(),S.value="1",v.value="0.5",b.value="free",m.value="",m.value=""});O.addEventListener("click",()=>{a(),c("已刷新")});U.addEventListener("click",()=>{window.confirm("确认清空全部短剧吗？")&&(u([]),a(),c("已清空"))});C.addEventListener("click",()=>{const e=d(),t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),r=URL.createObjectURL(t),n=document.createElement("a");n.href=r,n.download="cinenext_videos.json",n.click(),URL.revokeObjectURL(r),c("已导出 JSON")});p.addEventListener("change",async()=>{var t;const e=(t=p.files)==null?void 0:t[0];if(e)try{const r=await e.text(),n=L(r,null);if(!Array.isArray(n))throw new Error("JSON 格式无效，必须是数组");const s=n.map((o,y)=>({id:String(o.id||`legacy-import-${Date.now()}-${y}`),title:String(o.title||`短剧 ${y+1}`),playbackId:String(o.playbackId||"").trim(),playbackUrl:String(o.playbackUrl||`https://livepeercdn.com/hls/${o.playbackId||""}/index.m3u8`),unlockType:o.unlockType==="nft"?"nft":"free",nftCollectionAddress:String(o.nftCollectionAddress||""),price:String(o.price||"0.5"),actors:Array.isArray(o.actors)?o.actors:[],keywords:Array.isArray(o.keywords)?o.keywords:[],episode:Math.max(1,Number(o.episode||y+1)),likes:Number(o.likes||i(1e3,6e3)),views:Number(o.views||i(1e4,3e5))})).filter(o=>o.playbackId);u(s),a(),c("导入成功")}catch(r){c(r.message||"导入失败",!0)}finally{p.value=""}});a();
//# sourceMappingURL=admin-CPN43y8g.js.map
