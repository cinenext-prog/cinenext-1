{"version":3,"file":"admin-CPN43y8g.js","sources":["../../admin.js"],"sourcesContent":["const STORAGE_KEY = 'cinenext_videos';\nconst COMPAT_STORAGE_KEY = 'legacyVideos';\n\nconst form = document.querySelector('#video-form');\nconst titleInput = document.querySelector('#title');\nconst playbackIdInput = document.querySelector('#playbackId');\nconst playbackUrlInput = document.querySelector('#playbackUrl');\nconst episodeInput = document.querySelector('#episode');\nconst unlockTypeInput = document.querySelector('#unlockType');\nconst nftAddressInput = document.querySelector('#nftCollectionAddress');\nconst priceInput = document.querySelector('#price');\nconst actorsInput = document.querySelector('#actors');\nconst keywordsInput = document.querySelector('#keywords');\n\nconst tbody = document.querySelector('#video-tbody');\nconst table = document.querySelector('#video-table');\nconst emptyState = document.querySelector('#empty-state');\nconst toast = document.querySelector('#toast');\n\nconst resetFormBtn = document.querySelector('#reset-form');\nconst refreshBtn = document.querySelector('#refresh-list');\nconst clearAllBtn = document.querySelector('#clear-all');\nconst exportBtn = document.querySelector('#export-json');\nconst importInput = document.querySelector('#import-json');\n\nconst safeParse = (raw, fallback) => {\n  try {\n    return JSON.parse(raw);\n  } catch {\n    return fallback;\n  }\n};\n\nconst readList = () => {\n  const raw = localStorage.getItem(STORAGE_KEY) || localStorage.getItem(COMPAT_STORAGE_KEY);\n  if (!raw) return [];\n  const data = safeParse(raw, []);\n  return Array.isArray(data) ? data : [];\n};\n\nconst writeList = (list) => {\n  localStorage.setItem(STORAGE_KEY, JSON.stringify(list));\n  localStorage.setItem(COMPAT_STORAGE_KEY, JSON.stringify(list));\n};\n\nconst showToast = (text, isError = false) => {\n  toast.textContent = text;\n  toast.style.color = isError ? '#ff9d9d' : '#89d6a8';\n  window.setTimeout(() => {\n    if (toast.textContent === text) {\n      toast.textContent = '';\n    }\n  }, 2200);\n};\n\nconst parseCsv = (value) =>\n  String(value || '')\n    .split(',')\n    .map((v) => v.trim())\n    .filter(Boolean);\n\nconst randomStat = (min, max) => Math.floor(min + Math.random() * (max - min));\nconst looksLikeLivepeerPlaybackId = (value) => /^[a-zA-Z0-9_-]{8,}$/.test(value);\nconst looksLikePlayableUrl = (value) => /^https:\\/\\/.+\\.(m3u8|mp4)(\\?.*)?$/i.test(value);\n\nconst toRow = (video, index) => {\n  const tr = document.createElement('tr');\n  tr.innerHTML = `\n    <td>${video.title || '-'}</td>\n    <td>${video.episode || index + 1}</td>\n    <td>${video.playbackId || '-'}</td>\n    <td>${video.unlockType === 'nft' ? 'NFT' : '免费'}</td>\n    <td class=\"actions-cell\">\n      <button type=\"button\" data-action=\"delete\" data-id=\"${video.id}\">删除</button>\n    </td>\n  `;\n  return tr;\n};\n\nconst render = () => {\n  const list = readList();\n  tbody.innerHTML = '';\n\n  if (list.length === 0) {\n    table.hidden = true;\n    emptyState.hidden = false;\n    return;\n  }\n\n  table.hidden = false;\n  emptyState.hidden = true;\n  list.forEach((video, index) => {\n    tbody.appendChild(toRow(video, index));\n  });\n};\n\nconst buildVideo = () => {\n  const title = titleInput.value.trim();\n  const playbackId = playbackIdInput.value.trim();\n  const playbackUrl = playbackUrlInput.value.trim();\n\n  if (!title) {\n    throw new Error('请填写剧名');\n  }\n  if (!playbackId) {\n    throw new Error('请填写 Playback ID');\n  }\n  if (!looksLikeLivepeerPlaybackId(playbackId)) {\n    throw new Error('Playback ID 格式不正确，请填写 Livepeer 真实 Playback ID（不要填 1/2/3）');\n  }\n  if (playbackUrl && !looksLikePlayableUrl(playbackUrl)) {\n    throw new Error('播放地址格式不正确，请填写 https 开头的 m3u8/mp4 链接');\n  }\n\n  const unlockType = unlockTypeInput.value === 'nft' ? 'nft' : 'free';\n  const episode = Math.max(1, Number(episodeInput.value || 1));\n\n  return {\n    id: `legacy-${Date.now()}-${Math.random().toString(36).slice(2, 7)}`,\n    title,\n    playbackId,\n    playbackUrl: playbackUrl || `https://livepeercdn.com/hls/${playbackId}/index.m3u8`,\n    unlockType,\n    nftCollectionAddress: unlockType === 'nft' ? nftAddressInput.value.trim() : '',\n    price: String(priceInput.value || '0.5'),\n    actors: parseCsv(actorsInput.value),\n    keywords: parseCsv(keywordsInput.value),\n    episode,\n    likes: randomStat(1000, 6000),\n    views: randomStat(10000, 300000),\n  };\n};\n\nform.addEventListener('submit', (event) => {\n  event.preventDefault();\n\n  try {\n    const video = buildVideo();\n    const list = readList();\n\n    if (list.some((item) => item.playbackId === video.playbackId)) {\n      showToast('该 Playback ID 已存在', true);\n      return;\n    }\n\n    list.unshift(video);\n    writeList(list);\n    form.reset();\n    episodeInput.value = '1';\n    priceInput.value = '0.5';\n    unlockTypeInput.value = 'free';\n    render();\n    showToast('已添加短剧');\n  } catch (error) {\n    showToast(error.message || '添加失败', true);\n  }\n});\n\ntbody.addEventListener('click', (event) => {\n  const target = event.target;\n  if (!(target instanceof HTMLElement)) return;\n\n  if (target.dataset.action !== 'delete') return;\n  const id = target.dataset.id;\n  if (!id) return;\n\n  const list = readList();\n  const next = list.filter((item) => item.id !== id);\n  writeList(next);\n  render();\n  showToast('已删除');\n});\n\nresetFormBtn.addEventListener('click', () => {\n  form.reset();\n  episodeInput.value = '1';\n  priceInput.value = '0.5';\n  unlockTypeInput.value = 'free';\n  playbackUrlInput.value = '';\n  playbackUrlInput.value = '';\n});\n\nrefreshBtn.addEventListener('click', () => {\n  render();\n  showToast('已刷新');\n});\n\nclearAllBtn.addEventListener('click', () => {\n  const ok = window.confirm('确认清空全部短剧吗？');\n  if (!ok) return;\n  writeList([]);\n  render();\n  showToast('已清空');\n});\n\nexportBtn.addEventListener('click', () => {\n  const list = readList();\n  const blob = new Blob([JSON.stringify(list, null, 2)], { type: 'application/json' });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = 'cinenext_videos.json';\n  a.click();\n  URL.revokeObjectURL(url);\n  showToast('已导出 JSON');\n});\n\nimportInput.addEventListener('change', async () => {\n  const file = importInput.files?.[0];\n  if (!file) return;\n\n  try {\n    const text = await file.text();\n    const parsed = safeParse(text, null);\n    if (!Array.isArray(parsed)) {\n      throw new Error('JSON 格式无效，必须是数组');\n    }\n\n    const normalized = parsed\n      .map((item, index) => ({\n        id: String(item.id || `legacy-import-${Date.now()}-${index}`),\n        title: String(item.title || `短剧 ${index + 1}`),\n        playbackId: String(item.playbackId || '').trim(),\n        playbackUrl: String(item.playbackUrl || `https://livepeercdn.com/hls/${item.playbackId || ''}/index.m3u8`),\n        unlockType: item.unlockType === 'nft' ? 'nft' : 'free',\n        nftCollectionAddress: String(item.nftCollectionAddress || ''),\n        price: String(item.price || '0.5'),\n        actors: Array.isArray(item.actors) ? item.actors : [],\n        keywords: Array.isArray(item.keywords) ? item.keywords : [],\n        episode: Math.max(1, Number(item.episode || index + 1)),\n        likes: Number(item.likes || randomStat(1000, 6000)),\n        views: Number(item.views || randomStat(10000, 300000)),\n      }))\n      .filter((item) => item.playbackId);\n\n    writeList(normalized);\n    render();\n    showToast('导入成功');\n  } catch (error) {\n    showToast(error.message || '导入失败', true);\n  } finally {\n    importInput.value = '';\n  }\n});\n\nrender();\n"],"names":["STORAGE_KEY","COMPAT_STORAGE_KEY","form","titleInput","playbackIdInput","playbackUrlInput","episodeInput","unlockTypeInput","nftAddressInput","priceInput","actorsInput","keywordsInput","tbody","table","emptyState","toast","resetFormBtn","refreshBtn","clearAllBtn","exportBtn","importInput","safeParse","raw","fallback","readList","data","writeList","list","showToast","text","isError","parseCsv","value","v","randomStat","min","max","looksLikeLivepeerPlaybackId","looksLikePlayableUrl","toRow","video","index","tr","render","buildVideo","title","playbackId","playbackUrl","unlockType","episode","event","item","error","target","id","next","blob","url","a","file","_a","parsed","normalized"],"mappings":"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"}