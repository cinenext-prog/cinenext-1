import"./modulepreload-polyfill-B5Qt9EMX.js";const x="cinenext_videos",E="legacyVideos",k=document.querySelector("#video-form"),L=document.querySelector("#title"),C=document.querySelector("#playbackId"),b=document.querySelector("#playbackUrl"),g=document.querySelector("#episode"),h=document.querySelector("#unlockType"),T=document.querySelector("#nftCollectionAddress"),w=document.querySelector("#price"),$=document.querySelector("#actors"),N=document.querySelector("#keywords"),S=document.querySelector("#video-tbody"),v=document.querySelector("#video-table"),A=document.querySelector("#empty-state"),u=document.querySelector("#toast"),I=document.querySelector("#reset-form"),U=document.querySelector("#submit-btn"),O=document.querySelector("#form-title"),P=document.querySelector("#refresh-list"),B=document.querySelector("#clear-all"),D=document.querySelector("#export-json"),m=document.querySelector("#import-json");let d="";const M=(t,e)=>{try{return JSON.parse(t)}catch{return e}},p=()=>{const t=localStorage.getItem(x)||localStorage.getItem(E);if(!t)return[];const e=M(t,[]);return Array.isArray(e)?e:[]},f=t=>{localStorage.setItem(x,JSON.stringify(t)),localStorage.setItem(E,JSON.stringify(t))},a=(t,e=!1)=>{u.textContent=t,u.style.color=e?"#ff9d9d":"#89d6a8",window.setTimeout(()=>{u.textContent===t&&(u.textContent="")},2200)},q=t=>String(t||"").split(",").map(e=>e.trim()).filter(Boolean),y=(t,e)=>Math.floor(t+Math.random()*(e-t)),R=t=>/^[a-zA-Z0-9_-]{8,}$/.test(t),J=t=>/^https:\/\/.+\.(m3u8|mp4)(\?.*)?$/i.test(t),_=(t,e)=>{const r=document.createElement("tr");return r.innerHTML=`
    <td>${t.title||"-"}</td>
    <td>${t.episode||e+1}</td>
    <td>${t.playbackId||"-"}</td>
    <td>${t.unlockType==="nft"?"NFT":"免费"}</td>
    <td class="actions-cell">
      <button type="button" class="secondary" data-action="edit" data-id="${t.id}">编辑</button>
      <button type="button" data-action="delete" data-id="${t.id}">删除</button>
    </td>
  `,r},l=()=>{d="",O.textContent="新增短剧",U.textContent="添加到列表",I.textContent="清空输入",k.reset(),g.value="1",w.value="0.5",h.value="free",b.value=""},F=t=>{d=String(t.id),O.textContent="编辑短剧",U.textContent="保存修改",I.textContent="取消编辑",L.value=String(t.title||""),C.value=String(t.playbackId||""),b.value=String(t.playbackUrl||""),g.value=String(Math.max(1,Number(t.episode||1))),h.value=t.unlockType==="nft"?"nft":"free",T.value=String(t.nftCollectionAddress||""),w.value=String(t.price||"0.5"),$.value=Array.isArray(t.actors)?t.actors.join(", "):"",N.value=Array.isArray(t.keywords)?t.keywords.join(", "):"",k.scrollIntoView({behavior:"smooth",block:"start"})},i=()=>{const t=p();if(S.innerHTML="",t.length===0){v.hidden=!0,A.hidden=!1;return}v.hidden=!1,A.hidden=!0,t.forEach((e,r)=>{S.appendChild(_(e,r))})},H=()=>{const t=L.value.trim(),e=C.value.trim(),r=b.value.trim();if(!t)throw new Error("请填写剧名");if(!e)throw new Error("请填写 Playback ID");if(!R(e))throw new Error("Playback ID 格式不正确，请填写 Livepeer 真实 Playback ID（不要填 1/2/3）");if(r&&!J(r))throw new Error("播放地址格式不正确，请填写 https 开头的 m3u8/mp4 链接");const o=h.value==="nft"?"nft":"free",c=Math.max(1,Number(g.value||1));return{id:`legacy-${Date.now()}-${Math.random().toString(36).slice(2,7)}`,title:t,playbackId:e,playbackUrl:r||`https://livepeercdn.com/hls/${e}/index.m3u8`,unlockType:o,nftCollectionAddress:o==="nft"?T.value.trim():"",price:String(w.value||"0.5"),actors:q($.value),keywords:q(N.value),episode:c,likes:y(1e3,6e3),views:y(1e4,3e5)}};k.addEventListener("submit",t=>{t.preventDefault();try{const e=H(),r=p();if(r.some(n=>String(n.id)!==String(d)&&n.playbackId===e.playbackId&&Number(n.episode||1)===Number(e.episode||1))){a("该 Playback ID + 集数 组合已存在",!0);return}const c=r.findIndex(n=>String(n.id)===String(d));c>=0?r[c]={...r[c],...e,id:r[c].id}:r.unshift(e),f(r),l(),i(),a(c>=0?"已保存修改":"已添加短剧")}catch(e){a(e.message||"添加失败",!0)}});S.addEventListener("click",t=>{const e=t.target;if(!(e instanceof HTMLElement))return;const r=e.dataset.action,o=e.dataset.id;if(!o)return;const c=p();if(r==="edit"){const s=c.find(j=>String(j.id)===String(o));if(!s){a("未找到要编辑的记录",!0);return}F(s);return}if(r!=="delete")return;const n=c.filter(s=>s.id!==o);f(n),String(d)===String(o)&&l(),i(),a("已删除")});I.addEventListener("click",()=>{l()});P.addEventListener("click",()=>{i(),a("已刷新")});B.addEventListener("click",()=>{window.confirm("确认清空全部短剧吗？")&&(f([]),l(),i(),a("已清空"))});D.addEventListener("click",()=>{const t=p(),e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),r=URL.createObjectURL(e),o=document.createElement("a");o.href=r,o.download="cinenext_videos.json",o.click(),URL.revokeObjectURL(r),a("已导出 JSON")});m.addEventListener("change",async()=>{var e;const t=(e=m.files)==null?void 0:e[0];if(t)try{const r=await t.text(),o=M(r,null);if(!Array.isArray(o))throw new Error("JSON 格式无效，必须是数组");const c=o.map((n,s)=>({id:String(n.id||`legacy-import-${Date.now()}-${s}`),title:String(n.title||`短剧 ${s+1}`),playbackId:String(n.playbackId||"").trim(),playbackUrl:String(n.playbackUrl||`https://livepeercdn.com/hls/${n.playbackId||""}/index.m3u8`),unlockType:n.unlockType==="nft"?"nft":"free",nftCollectionAddress:String(n.nftCollectionAddress||""),price:String(n.price||"0.5"),actors:Array.isArray(n.actors)?n.actors:[],keywords:Array.isArray(n.keywords)?n.keywords:[],episode:Math.max(1,Number(n.episode||s+1)),likes:Number(n.likes||y(1e3,6e3)),views:Number(n.views||y(1e4,3e5))})).filter(n=>n.playbackId);f(c),l(),i(),a("导入成功")}catch(r){a(r.message||"导入失败",!0)}finally{m.value=""}});l();i();
//# sourceMappingURL=admin-BdN_Xj_s.js.map
